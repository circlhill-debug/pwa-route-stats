<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Route Stats — Metrics Data Sheet</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f8f9fb;
      --fg: #111;
      --muted: #666;
      --card: #fff;
      --border: #d8dbe0;
      --accent: #0b5fff;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #121417;
        --fg: #f3f4f7;
        --muted: #9aa0ad;
        --card: #1d2128;
        --border: #2c3139;
        --accent: #5c8dff;
      }
    }
    body {
      margin: 0;
      font-family: "Inter", "SF Pro Text", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
    }
    header {
      background: var(--card);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }
    main {
      max-width: 820px;
      margin: 0 auto;
      padding: 32px 24px 60px;
    }
    h2, h3 {
      margin-top: 32px;
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    h2:first-of-type {
      margin-top: 16px;
    }
    p {
      margin: 12px 0;
    }
    ul {
      margin: 12px 0 12px 24px;
      padding: 0;
    }
    li {
      margin: 6px 0;
    }
    code {
      font-family: "JetBrains Mono", "SFMono-Regular", ui-monospace, "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.95em;
      color: var(--accent);
      background: color-mix(in srgb, var(--accent) 10%, transparent);
      padding: 0 4px;
      border-radius: 4px;
    }
    pre {
      background: color-mix(in srgb, var(--fg) 8%, transparent);
      padding: 12px 16px;
      border-radius: 8px;
      overflow-x: auto;
    }
    .loading,
    .error {
      color: var(--muted);
      font-size: 14px;
    }
    a.back-link {
      color: inherit;
      text-decoration: none;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    a.back-link:hover {
      color: var(--accent);
    }
  </style>
</head>
<body>
  <header>
    <a class="back-link" href="../index.html">
      <span aria-hidden="true">←</span>
      Back to App
    </a>
    <h1>Route Stats — Metrics Data Sheet</h1>
  </header>
  <main>
    <p id="status" class="loading">Loading metrics…</p>
    <article id="content" hidden></article>
  </main>
  <script>
    function escapeHtml(str) {
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    function formatInline(text) {
      return escapeHtml(text).replace(/`([^`]+)`/g, '<code>$1</code>');
    }

    function renderMarkdown(md) {
      const lines = md.split(/\r?\n/);
      const chunks = [];
      let inList = false;
      let paragraph = [];

      function flushParagraph() {
        if (paragraph.length) {
          const text = paragraph.join(' ');
          chunks.push('<p>' + formatInline(text) + '</p>');
          paragraph = [];
        }
      }

      function closeList() {
        if (inList) {
          chunks.push('</ul>');
          inList = false;
        }
      }

      for (const line of lines) {
        if (!line.trim()) {
          flushParagraph();
          closeList();
          continue;
        }

        if (line.startsWith('### ')) {
          flushParagraph();
          closeList();
          chunks.push('<h3>' + formatInline(line.slice(4)) + '</h3>');
          continue;
        }

        if (line.startsWith('## ')) {
          flushParagraph();
          closeList();
          chunks.push('<h2>' + formatInline(line.slice(3)) + '</h2>');
          continue;
        }

        if (line.startsWith('# ')) {
          flushParagraph();
          closeList();
          chunks.push('<h1>' + formatInline(line.slice(2)) + '</h1>');
          continue;
        }

        if (line.startsWith('- ')) {
          flushParagraph();
          if (!inList) {
            chunks.push('<ul>');
            inList = true;
          }
          chunks.push('<li>' + formatInline(line.slice(2)) + '</li>');
          continue;
        }

        paragraph.push(line.trim());
      }

      flushParagraph();
      closeList();
      return chunks.join('\n');
    }

    async function init() {
      const status = document.getElementById('status');
      const container = document.getElementById('content');
      try {
        const res = await fetch('METRICS.md', { cache: 'no-cache' });
        if (!res.ok) throw new Error('Failed to fetch metrics (' + res.status + ')');
        const text = await res.text();
        container.innerHTML = renderMarkdown(text);
        container.hidden = false;
        status.remove();
      } catch (err) {
        status.textContent = 'Unable to load the data sheet. ' + err.message;
        status.className = 'error';
      }
    }

    init();
  </script>
</body>
</html>
